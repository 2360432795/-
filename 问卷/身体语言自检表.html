<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>身体语言自检表系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f9fc;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #4a6fa5, #166088);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .description {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }
        
        .personal-info-section {
            width: 100%;
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .questionnaire-section {
            flex: 3;
            min-width: 350px;
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .results-section {
            flex: 2;
            min-width: 350px;
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
            color: #166088;
            position: sticky;
            top: 0;
            background-color: white;
            z-index: 10;
        }
        
        .section-title i {
            margin-right: 10px;
            font-size: 1.5rem;
        }
        
        .health-dimensions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .dimension-tag {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        
        .dimension-tag i {
            margin-right: 5px;
        }
        
        .question-item {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 8px;
            background-color: #f8fafc;
            border-left: 4px solid #4a6fa5;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .question-item.female-only {
            border-left-color: #ff6b8b;
            background-color: #fff5f7;
        }
        
        .question-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
        }
        
        .symptom-text {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            display: flex;
            align-items: center;
        }
        
        .symptom-id {
            display: inline-block;
            width: 25px;
            font-weight: bold;
            color: #166088;
        }
        
        .symptom-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .symptom-tag {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            background-color: #e9f2f9;
            color: #166088;
            border: 1px solid #c2d7e9;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
        }
        
        .checkbox-container input {
            margin-right: 10px;
            transform: scale(1.2);
            cursor: pointer;
        }
        
        .checkbox-container label {
            cursor: pointer;
            font-size: 0.95rem;
        }
        
        .button-container {
            text-align: center;
            margin-top: 30px;
            position: sticky;
            bottom: 0;
            background-color: white;
            padding-top: 15px;
            padding-bottom: 5px;
        }
        
        button {
            padding: 12px 25px;
            background-color: #166088;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 5px;
        }
        
        button:hover {
            background-color: #0d4a6b;
            transform: translateY(-3px);
        }
        
        button i {
            margin-right: 8px;
        }
        
        .dimension-results {
            margin-bottom: 25px;
        }
        
        .dimension-score {
            margin-bottom: 15px;
        }
        
        .dimension-name {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .score-bar-container {
            height: 16px;
            background-color: #eaeaea;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 3px;
        }
        
        .score-bar {
            height: 100%;
            border-radius: 8px;
            transition: width 0.8s ease-out;
        }
        
        .score-text {
            font-size: 0.85rem;
            color: #666;
            text-align: right;
        }
        
        .report-container {
            background-color: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
            border-left: 4px solid #4a6fa5;
        }
        
        .report-title {
            margin-bottom: 15px;
            color: #166088;
            font-size: 1.3rem;
        }
        
        .report-content {
            line-height: 1.7;
        }
        
        .report-dimension {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #ddd;
        }
        
        .report-dimension:last-child {
            border-bottom: none;
        }
        
        .dimension-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            align-items: center;
        }
        
        .dimension-advice {
            font-size: 0.9rem;
            color: #444;
        }
        
        .dimension-score-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            color: white;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: #777;
            font-size: 0.9rem;
            padding: 20px;
            border-top: 1px solid #eee;
        }
        
        .hidden {
            display: none;
        }
        
        .selection-count {
            margin: 15px 0;
            font-weight: 600;
            color: #166088;
            font-size: 1.1rem;
        }
        
        .symptom-category {
            background-color: #e9f2f9;
            padding: 10px 15px;
            margin: 20px 0 10px 0;
            border-radius: 8px;
            font-weight: bold;
            color: #166088;
            border-left: 4px solid #4a6fa5;
        }
        
        /* 个人信息表单样式 */
        .personal-info-form {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group.required label::after {
            content: " *";
            color: #e74c3c;
        }
        
        .form-group input, .form-group select {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4a6fa5;
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }
        
        .gender-options {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }
        
        .gender-option {
            display: flex;
            align-items: center;
        }
        
        .gender-option input {
            margin-right: 8px;
            transform: scale(1.2);
        }
        
        .form-note {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #777;
            font-style: italic;
        }
        
        .required-note {
            margin-top: 20px;
            color: #e74c3c;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .time-period-note {
            background-color: #fff9e6;
            border-left: 4px solid #ffc107;
            padding: 12px 15px;
            margin-bottom: 20px;
            border-radius: 6px;
            font-size: 0.95rem;
        }
        
        .time-period-note i {
            color: #ff9800;
            margin-right: 8px;
        }
        
        /* 历史记录样式 */
        .history-section {
            margin-top: 20px;
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .history-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .history-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
        }
        
        .history-item {
            padding: 12px;
            margin-bottom: 10px;
            background-color: #f8fafc;
            border-radius: 6px;
            border-left: 4px solid #4a6fa5;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .history-item:hover {
            background-color: #e9f2f9;
            transform: translateX(5px);
        }
        
        .history-item.selected {
            background-color: #e1ecf7;
            border-left-color: #166088;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .history-date {
            font-weight: bold;
            color: #166088;
        }
        
        .history-name {
            font-weight: 600;
        }
        
        .history-scores {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 8px;
        }
        
        .history-score-tag {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            background-color: #e9f2f9;
            color: #166088;
            border: 1px solid #c2d7e9;
        }
        
        .empty-history {
            text-align: center;
            padding: 40px 20px;
            color: #777;
            font-style: italic;
        }
        
        .history-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .secondary-button {
            background-color: #6c757d;
        }
        
        .secondary-button:hover {
            background-color: #545b62;
        }
        
        .danger-button {
            background-color: #e74c3c;
        }
        
        .danger-button:hover {
            background-color: #c0392b;
        }
        
        .success-button {
            background-color: #28a745;
        }
        
        .success-button:hover {
            background-color: #1e7e34;
        }
        
        @media (max-width: 1100px) {
            .container {
                flex-direction: column;
            }
            
            .questionnaire-section, .results-section {
                max-height: none;
                overflow-y: visible;
            }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .symptom-text {
                font-size: 0.9rem;
            }
            
            .personal-info-form {
                grid-template-columns: 1fr;
            }
            
            .history-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .button-container {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            button {
                margin: 5px;
                flex: 1;
                min-width: 140px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-stethoscope"></i> 身体语言自检表系统</h1>
        <p class="description">通过分析身体症状与健康维度的关联关系，为您提供全面的身体状态评估。请根据近三个月的感受填写。</p>
    </header>
    
    <section class="personal-info-section">
        <div class="section-title">
            <i class="fas fa-user"></i>
            <h2>个人信息</h2>
        </div>
        
        <form id="personal-info-form" class="personal-info-form">
            <div class="form-group required">
                <label for="name">姓名</label>
                <input type="text" id="name" name="name" required placeholder="请输入您的姓名">
            </div>
            
            <div class="form-group required">
                <label for="gender">性别</label>
                <div class="gender-options">
                    <div class="gender-option">
                        <input type="radio" id="male" name="gender" value="male" required>
                        <label for="male">男</label>
                    </div>
                    <div class="gender-option">
                        <input type="radio" id="female" name="gender" value="female" required>
                        <label for="female">女</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group required">
                <label for="age">年龄</label>
                <input type="number" id="age" name="age" min="1" max="120" required placeholder="请输入您的年龄">
            </div>
            
            <div class="form-group required">
                <label for="record-date">填表日期</label>
                <input type="date" id="record-date" name="record-date" required>
            </div>
            
            <div class="form-group">
                <label for="occupation">职业</label>
                <input type="text" id="occupation" name="occupation" placeholder="请输入您的职业">
            </div>
            
            <div class="form-group">
                <label for="education">学历</label>
                <select id="education" name="education">
                    <option value="">请选择您的学历</option>
                    <option value="初中及以下">初中及以下</option>
                    <option value="高中/中专">高中/中专</option>
                    <option value="大专">大专</option>
                    <option value="本科">本科</option>
                    <option value="硕士">硕士</option>
                    <option value="博士">博士</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="phone">电话</label>
                <input type="tel" id="phone" name="phone" placeholder="请输入您的联系电话">
            </div>
        </form>
        
        <div class="required-note">注：带 * 的项为必填项</div>
        
        <div class="form-note" id="gender-note" style="display: none; margin-top: 20px; padding: 10px; background-color: #e9f2f9; border-radius: 6px; border-left: 4px solid #ff6b8b;">
            <i class="fas fa-info-circle"></i> 提示：系统检测到您选择的是男性，已将女性专属症状（71-79项）自动隐藏。
        </div>
    </section>
    
    <div class="container">
        <section class="questionnaire-section">
            <div class="section-title">
                <i class="fas fa-clipboard-list"></i>
                <h2>身体语言自检表 (共95项)</h2>
            </div>
            
            <div class="time-period-note">
                <i class="fas fa-calendar-alt"></i> 
                <strong>填写说明：</strong>请根据您<b>近三个月</b>的身体感受，选择符合的症状（可多选）。
            </div>
            
            <div id="selection-count" class="selection-count">已选择 0 个症状</div>
            
            <div id="symptoms-container">
                <!-- 症状选项将通过JavaScript动态生成 -->
            </div>
            
            <div class="button-container">
                <button id="calculate-btn">
                    <i class="fas fa-calculator"></i> 计算身体状态得分
                </button>
                <button id="reset-btn" class="secondary-button">
                    <i class="fas fa-redo"></i> 重置选择
                </button>
                <button id="save-btn" class="success-button">
                    <i class="fas fa-save"></i> 保存当前记录
                </button>
            </div>
        </section>
        
        <section class="results-section">
            <div class="section-title">
                <i class="fas fa-chart-bar"></i>
                <h2>身体维度分析</h2>
            </div>
            
            <div class="health-dimensions">
                <!-- 维度标签将通过JavaScript动态生成 -->
            </div>
            
            <div id="dimension-results" class="dimension-results">
                <!-- 维度得分结果将通过JavaScript动态生成 -->
            </div>
            
            <div id="report-container" class="report-container hidden">
                <h3 class="report-title"><i class="fas fa-file-medical-alt"></i> 身体状态分析报告</h3>
                <div id="report-content" class="report-content">
                    <!-- 报告内容将通过JavaScript动态生成 -->
                </div>
            </div>
        </section>
    </div>
    
    <section class="history-section">
        <div class="section-title">
            <i class="fas fa-history"></i>
            <h2>历史记录</h2>
        </div>
        
        <div class="history-controls">
            <div>
                <button id="view-history-btn" class="secondary-button">
                    <i class="fas fa-list"></i> 查看历史记录
                </button>
                <button id="clear-history-btn" class="danger-button">
                    <i class="fas fa-trash"></i> 清空历史记录
                </button>
            </div>
            <div id="history-count" class="selection-count">共有 0 条历史记录</div>
        </div>
        
        <div id="history-list" class="history-list hidden">
            <!-- 历史记录将通过JavaScript动态生成 -->
        </div>
        
        <div id="empty-history" class="empty-history hidden">
            <i class="fas fa-history fa-3x" style="color: #ddd; margin-bottom: 15px;"></i>
            <p>暂无历史记录，填写并保存后可以在此查看历史表单及评分。</p>
        </div>
    </section>
    
    <footer>
        <p>身体语言自检表系统 &copy; 2023 | 本报告仅供参考，不能替代专业医疗建议</p>
    </footer>

    <script>
        // 健康维度定义 - 根据PDF中的7个维度
        const healthDimensions = [
            { id: 'qi_blood', name: '气血', color: '#FF6B6B', icon: 'fas fa-tint', description: '与能量、活力、血液循环相关' },
            { id: 'circulation', name: '循环', color: '#4ECDC4', icon: 'fas fa-heartbeat', description: '与心血管、血液循环、微循环相关' },
            { id: 'toxin', name: '毒素', color: '#A05195', icon: 'fas fa-skull-crossbones', description: '与体内毒素积累、排毒功能相关' },
            { id: 'blood_lipid', name: '血脂', color: '#FFD166', icon: 'fas fa-chart-line', description: '与血脂代谢、胆固醇水平相关' },
            { id: 'cold_damp', name: '寒湿', color: '#118AB2', icon: 'fas fa-snowflake', description: '与寒湿体质、湿气重相关' },
            { id: 'immunity', name: '免疫', color: '#06D6A0', icon: 'fas fa-shield-alt', description: '与抵抗力、炎症、过敏相关' },
            { id: 'emotion', name: '情绪', color: '#7209B7', icon: 'fas fa-smile', description: '与情绪状态、压力、心理相关' }
            ];
        
        // 症状定义 - 根据PDF中的95个症状
        const symptoms = [
            // 头部症状 (1-12)
            { id: 1, text: '记忆力下降', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid'], category: '头部症状', femaleOnly: false },
            { id: 2, text: '思维断电', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid'], category: '头部症状', femaleOnly: false },
            { id: 3, text: '反应迟钝', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid','cold_damp'], category: '头部症状', femaleOnly: false },
            { id: 4, text: '嗜睡', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid','cold_damp'], category: '头部症状', femaleOnly: false },
            { id: 5, text: '多梦', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid','emotion'], category: '头部症状', femaleOnly: false },
            { id: 6, text: '头晕', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid','immunity','emotion'], category: '头部症状', femaleOnly: false },
            { id: 7, text: '头疼', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid','cold_damp','immunity','emotion'], category: '头部症状', femaleOnly: false },
            { id: 8, text: '头麻', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid','cold_damp','emotion'], category: '头部症状', femaleOnly: false },
            { id: 9, text: '晕车', tags: ['qi_blood', 'toxin','emotion'], category: '头部症状', femaleOnly: false },
            { id: 10, text: '失眠', tags: ['toxin','emotion'], category: '头部症状', femaleOnly: false },
            { id: 11, text: '头面油腻', tags: ['blood_lipid','cold_damp'], category: '头部症状', femaleOnly: false },
           
            
            // 头发症状 (13-14)
            { id: 12, text: '脱发', tags: ['qi_blood', 'circulation', 'blood_lipid','immunity','emotion'], category: '头发症状', femaleOnly: false },
            { id: 13, text: '头发稀少', tags: ['qi_blood', 'circulation','blood_lipid','emotion'], category: '头发症状', femaleOnly: false },
            
            // 呼吸症状 (15-16)
             { id: 14, text: '易打哈欠', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'cold_damp'], category: '呼吸症状', femaleOnly: false },
             { id: 15, text: '常叹气', tags: ['qi_blood', 'circulation', 'toxin', 'emotion'], category: '呼吸症状', femaleOnly: false },
            
            // 眼部症状 (16-22)
            { id: 16, text: '眼干涩', tags: ['qi_blood', 'circulation'], category: '眼部症状', femaleOnly: false },
            { id: 17, text: '眼痒', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'immunity'], category: '眼部症状', femaleOnly: false },
            { id: 18, text: '眼痛', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'immunity'], category: '眼部症状', femaleOnly: false },
            { id: 19, text: '视力模糊', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid'], category: '眼部症状', femaleOnly: false },
            { id: 20, text: '眼屎多', tags: ['toxin', 'blood_lipid'], category: '眼部症状', femaleOnly: false },
            { id: 21, text: '眼怕光流泪', tags: ['toxin', 'blood_lipid', 'immunity'], category: '眼部症状', femaleOnly: false },
            { id: 22, text: '麦粒肿', tags: ['blood_lipid'], category: '眼部症状', femaleOnly: false },
            
            // 耳部症状 (23-28)
            { id: 23, text: '听力下降', tags: ['qi_blood', 'circulation', 'blood_lipid', 'emotion'], category: '耳部症状', femaleOnly: false },
            { id: 24, text: '耳痒', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'immunity'], category: '耳部症状', femaleOnly: false },
            { id: 25, text: '耳鸣', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'emotion'], category: '耳部症状', femaleOnly: false },
            { id: 26, text: '耳痛', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'immunity'], category: '耳部症状', femaleOnly: false },
            { id: 27, text: '耳屎多', tags: ['toxin', 'blood_lipid'], category: '耳部症状', femaleOnly: false },
            { id: 28, text: '耳内潮湿', tags: ['toxin', 'cold_damp', 'immunity'], category: '耳部症状', femaleOnly: false },
            
            // 鼻部症状 (29-34)
            { id: 29, text: '打鼾', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid'], category: '鼻部症状', femaleOnly: false },
            { id: 30, text: '鼻塞', tags: ['circulation', 'blood_lipid', 'cold_damp', 'immunity'], category: '鼻部症状', femaleOnly: false },
            { id: 31, text: '爱打喷嚏', tags: ['toxin', 'cold_damp', 'immunity'], category: '鼻部症状', femaleOnly: false },
            { id: 32, text: '常流鼻涕', tags: ['cold_damp', 'immunity'], category: '鼻部症状', femaleOnly: false },
            { id: 33, text: '鼻炎', tags: ['circulation', 'cold_damp', 'immunity'], category: '鼻部症状', femaleOnly: false },
            { id: 34, text: '感冒时间长', tags: ['qi_blood', 'circulation', 'cold_damp', 'immunity', 'emotion'], category: '鼻部症状', femaleOnly: false },
            
            // 喉部症状 (35-40)
            { id: 35, text: '嗓子干', tags: ['qi_blood', 'circulation', 'toxin'], category: '喉部症状', femaleOnly: false },
            { id: 36, text: '喉咙痒', tags: ['qi_blood', 'circulation', 'toxin', 'cold_damp', 'immunity'], category: '喉部症状', femaleOnly: false },
            { id: 37, text: '喉咙痛', tags: ['qi_blood', 'circulation', 'cold_damp', 'immunity', 'emotion'], category: '喉部症状', femaleOnly: false },
            { id: 38, text: '咳嗽', tags: ['cold_damp', 'immunity'], category: '喉部症状', femaleOnly: false },
            { id: 39, text: '痰多', tags: ['cold_damp', 'immunity'], category: '喉部症状', femaleOnly: false },
            { id: 40, text: '呼吸困难', tags: ['qi_blood', 'circulation', 'cold_damp', 'immunity'], category: '喉部症状', femaleOnly: false },
            
            // 口腔症状 (41-47)
            { id: 41, text: '口苦', tags: ['toxin', 'blood_lipid'], category: '口腔症状', femaleOnly: false },
            { id: 42, text: '口干', tags: ['circulation', 'toxin', 'blood_lipid'], category: '口腔症状', femaleOnly: false },
            { id: 43, text: '口臭', tags: ['circulation', 'toxin', 'blood_lipid'], category: '口腔症状', femaleOnly: false },
            { id: 44, text: '口溃疡', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'cold_damp', 'immunity', 'emotion'], category: '口腔症状', femaleOnly: false },
            { id: 45, text: '舌溃疡', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'immunity', 'emotion'], category: '口腔症状', femaleOnly: false },
            { id: 46, text: '嘴唇麻', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid'], category: '口腔症状', femaleOnly: false },
            { id: 47, text: '舌硬', tags: ['circulation', 'toxin', 'blood_lipid'], category: '口腔症状', femaleOnly: false },
            
            // 胸部症状 (48)
            { id: 48, text: '胸闷气短', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'cold_damp', 'emotion'], category: '胸部症状', femaleOnly: false },
            
            // 心脏症状 (49-50)
            { id: 49, text: '心慌心悸', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'cold_damp', 'emotion'], category: '心脏症状', femaleOnly: false },
            { id: 50, text: '心绞痛', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'cold_damp', 'emotion'], category: '心脏症状', femaleOnly: false },
            
            // 手脚症状 (51-57)
            { id: 51, text: '指甲凹陷', tags: ['qi_blood', 'circulation'], category: '手脚症状', femaleOnly: false },
            { id: 52, text: '半月痕少', tags: ['qi_blood', 'circulation'], category: '手脚症状', femaleOnly: false },
            { id: 53, text: '手脚脱皮', tags: ['qi_blood', 'circulation', 'immunity'], category: '手脚症状', femaleOnly: false },
            { id: 54, text: '手脚出汗', tags: ['cold_damp'], category: '手脚症状', femaleOnly: false },
            { id: 55, text: '手脚凉', tags: ['cold_damp', 'qi_blood', 'circulation'], category: '手脚症状', femaleOnly: false },
            { id: 56, text: '手脚热', tags: ['toxin', 'blood_lipid', 'cold_damp'], category: '手脚症状', femaleOnly: false },
            { id: 57, text: '手足麻木', tags: ['qi_blood', 'circulation', 'blood_lipid', 'cold_damp'], category: '手脚症状', femaleOnly: false },
            
            // 四肢症状 (58-63)
            { id: 58, text: '四肢乏力', tags: ['qi_blood', 'circulation', 'blood_lipid'], category: '四肢症状', femaleOnly: false },
            { id: 59, text: '静脉曲张', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'cold_damp', 'immunity'], category: '四肢症状', femaleOnly: false },
            { id: 60, text: '关节痛', tags: ['qi_blood', 'circulation', 'cold_damp', 'immunity'], category: '四肢症状', femaleOnly: false },
            { id: 61, text: '肩酸痛', tags: ['qi_blood', 'circulation', 'cold_damp', 'immunity'], category: '四肢症状', femaleOnly: false },
            { id: 62, text: '颈椎痛', tags: ['qi_blood', 'circulation', 'cold_damp', 'immunity'], category: '四肢症状', femaleOnly: false },
            { id: 63, text: '腰酸痛', tags: ['qi_blood', 'circulation', 'cold_damp', 'immunity'], category: '四肢症状', femaleOnly: false },
            
            // 泌尿症状 (64-67)
            { id: 64, text: '尿浑浊', tags: ['toxin', 'blood_lipid'], category: '泌尿症状', femaleOnly: false },
            { id: 65, text: '尿多沫', tags: ['toxin', 'blood_lipid'], category: '泌尿症状', femaleOnly: false },
            { id: 66, text: '尿有怪味', tags: ['toxin', 'blood_lipid'], category: '泌尿症状', femaleOnly: false },
            { id: 67, text: '夜尿多', tags: ['qi_blood', 'circulation', 'blood_lipid', 'cold_damp'], category: '泌尿症状', femaleOnly: false },
            
            // 消化症状 (68-71)
            { id: 68, text: '便秘', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'cold_damp', 'emotion'], category: '消化症状', femaleOnly: false },
            { id: 69, text: '大便不成形', tags: ['blood_lipid', 'cold_damp', 'emotion'], category: '消化症状', femaleOnly: false },
            { id: 70, text: '便溏不净', tags: ['blood_lipid', 'cold_damp'], category: '消化症状', femaleOnly: false },
            
            // 妇科症状 (71-79) - 女性相关
            { id: 71, text: '经期头痛', tags: ['qi_blood', 'toxin', 'cold_damp', 'immunity', 'emotion'], category: '妇科症状', femaleOnly: true },
            { id: 72, text: '月经量少', tags: ['qi_blood', 'circulation', 'cold_damp', 'emotion'], category: '妇科症状', femaleOnly: true },
            { id: 73, text: '经期时长', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'cold_damp', 'emotion'], category: '妇科症状', femaleOnly: true },
            { id: 74, text: '经期推后', tags: ['qi_blood', 'circulation', 'cold_damp', 'emotion'], category: '妇科症状', femaleOnly: true },
            { id: 75, text: '月经有血块', tags: ['qi_blood', 'circulation', 'toxin', 'blood_lipid', 'cold_damp', 'immunity', 'emotion'], category: '妇科症状', femaleOnly: true },
            { id: 76, text: '乳腺增生结节', tags: ['circulation', 'toxin', 'blood_lipid', 'cold_damp', 'emotion'], category: '妇科症状', femaleOnly: true },
            { id: 77, text: '经期腰痛', tags: ['qi_blood', 'circulation', 'cold_damp', 'immunity'], category: '妇科症状', femaleOnly: true },
            { id: 78, text: '经期提前', tags: ['qi_blood', 'toxin', 'emotion'], category: '妇科症状', femaleOnly: true },
            { id: 79, text: '月经量多', tags: ['toxin', 'emotion'], category: '妇科症状', femaleOnly: true },
            
            // 其他症状 (80-95)
            { id: 80, text: '不爱说话', tags: ['qi_blood', 'emotion'], category: '其他症状', femaleOnly: false },
            { id: 81, text: '恶心', tags: ['qi_blood', 'toxin', 'emotion'], category: '其他症状', femaleOnly: false },
            { id: 82, text: '胃胀', tags: ['qi_blood', 'cold_damp', 'emotion'], category: '其他症状', femaleOnly: false },
            { id: 83, text: '胃酸', tags: ['qi_blood', 'cold_damp', 'emotion'], category: '其他症状', femaleOnly: false },
            { id: 84, text: '胃痛', tags: ['qi_blood', 'cold_damp', 'immunity', 'emotion'], category: '其他症状', femaleOnly: false },
            { id: 85, text: '消化不良', tags: ['qi_blood', 'blood_lipid', 'cold_damp', 'emotion'], category: '其他症状', femaleOnly: false },
            { id: 86, text: '肥胖', tags: ['blood_lipid', 'cold_damp', 'emotion'], category: '其他症状', femaleOnly: false },
            { id: 87, text: '皮肤痒', tags: ['qi_blood', 'circulation', 'toxin', 'cold_damp', 'immunity'], category: '其他症状', femaleOnly: false },
            { id: 88, text: '湿疹', tags: ['qi_blood', 'blood_lipid', 'cold_damp', 'immunity'], category: '其他症状', femaleOnly: false },
            { id: 89, text: '各种过敏', tags: ['qi_blood', 'toxin', 'cold_damp', 'immunity'], category: '其他症状', femaleOnly: false },
            { id: 90, text: '痤疮', tags: ['circulation', 'toxin', 'blood_lipid', 'immunity', 'emotion'], category: '其他症状', femaleOnly: false },
            { id: 91, text: '脂肪瘤', tags: ['blood_lipid', 'cold_damp', 'immunity'], category: '其他症状', femaleOnly: false },
            { id: 92, text: '身体异味', tags: ['circulation', 'toxin', 'blood_lipid'], category: '其他症状', femaleOnly: false },
            { id: 93, text: '淋巴肿大', tags: ['circulation', 'toxin', 'cold_damp', 'immunity', 'emotion'], category: '其他症状', femaleOnly: false },
            { id: 94, text: '黑痣变大变多', tags: ['toxin', 'immunity'], category: '其他症状', femaleOnly: false },
            { id: 95, text: '形体消瘦', tags: ['qi_blood', 'immunity', 'emotion'], category: '其他症状', femaleOnly: false }
        ];
        
        // 当前用户性别
        let currentGender = null;
        let currentDimensionStats = null;
        let currentPersonalInfo = null;
        let currentSelectedSymptoms = null;
        
        // 初始化问卷
        document.addEventListener('DOMContentLoaded', function() {
            // 设置填表日期默认为今天
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('record-date').value = formattedDate;
            
            // 生成健康维度标签
            const dimensionsContainer = document.querySelector('.health-dimensions');
            healthDimensions.forEach(dimension => {
                const dimensionTag = document.createElement('div');
                dimensionTag.className = 'dimension-tag';
                dimensionTag.style.backgroundColor = dimension.color;
                dimensionTag.style.color = 'white';
                dimensionTag.innerHTML = `<i class="${dimension.icon}"></i> ${dimension.name}`;
                dimensionTag.title = dimension.description;
                dimensionsContainer.appendChild(dimensionTag);
            });
            
            // 生成症状选项，按类别分组
            generateSymptoms();
            
            // 绑定计算按钮事件
            document.getElementById('calculate-btn').addEventListener('click', calculateScores);
            
            // 绑定重置按钮事件
            document.getElementById('reset-btn').addEventListener('click', resetQuestionnaire);
            
            // 绑定保存按钮事件
            document.getElementById('save-btn').addEventListener('click', saveCurrentRecord);
            
            // 绑定查看历史记录按钮事件
            document.getElementById('view-history-btn').addEventListener('click', toggleHistoryList);
            
            // 绑定清空历史记录按钮事件
            document.getElementById('clear-history-btn').addEventListener('click', clearHistory);
            
            // 绑定性别选择变化事件
            document.querySelectorAll('input[name="gender"]').forEach(radio => {
                radio.addEventListener('change', handleGenderChange);
            });
            
            // 绑定症状选择事件，更新计数
            document.addEventListener('change', function(e) {
                if (e.target.matches('input[name="symptom"]')) {
                    updateSelectionCount();
                }
            });
            
            // 初始化选择计数
            updateSelectionCount();
            
            // 初始化历史记录计数
            updateHistoryCount();
        });
        
        // 生成症状列表
        function generateSymptoms() {
            const symptomsContainer = document.getElementById('symptoms-container');
            symptomsContainer.innerHTML = '';
            
            const categories = [...new Set(symptoms.map(s => s.category))];
            
            categories.forEach(category => {
                // 添加类别标题
                const categoryElement = document.createElement('div');
                categoryElement.className = 'symptom-category';
                categoryElement.textContent = category;
                symptomsContainer.appendChild(categoryElement);
                
                // 添加该类别的所有症状
                symptoms.filter(s => s.category === category).forEach(symptom => {
                    const questionItem = document.createElement('div');
                    questionItem.className = 'question-item';
                    if (symptom.femaleOnly) {
                        questionItem.classList.add('female-only');
                    }
                    questionItem.dataset.symptomId = symptom.id;
                    questionItem.dataset.femaleOnly = symptom.femaleOnly;
                    
                    questionItem.innerHTML = `
                        <div class="symptom-text">
                            <span class="symptom-id">${symptom.id}.</span> ${symptom.text}
                            ${symptom.femaleOnly ? '<span style="margin-left: 10px; font-size: 0.8rem; color: #ff6b8b; font-weight: normal;">(女性专属)</span>' : ''}
                        </div>
                        <div class="symptom-tags">
                            ${symptom.tags.map(tagId => {
                                const dimension = healthDimensions.find(d => d.id === tagId);
                                if (!dimension) return '';
                                return `<span class="symptom-tag" style="background-color: ${dimension.color}22; color: ${dimension.color}; border: 1px solid ${dimension.color}55">${dimension.name}</span>`;
                            }).join('')}
                            ${symptom.tags.length === 0 ? '<span class="symptom-tag" style="background-color: #eee; color: #777; border: 1px solid #ddd">无标签</span>' : ''}
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" id="symptom-${symptom.id}" name="symptom" value="${symptom.id}" data-tags='${JSON.stringify(symptom.tags)}'>
                            <label for="symptom-${symptom.id}">近三个月有此感受</label>
                        </div>
                    `;
                    symptomsContainer.appendChild(questionItem);
                });
            });
            
            // 应用性别筛选（如果已选择性别）
            if (currentGender) {
                filterSymptomsByGender(currentGender);
            }
        }
        
        // 处理性别变化
        function handleGenderChange() {
            const gender = document.querySelector('input[name="gender"]:checked');
            if (!gender) return;
            
            currentGender = gender.value;
            filterSymptomsByGender(currentGender);
            
            // 显示/隐藏性别提示
            const genderNote = document.getElementById('gender-note');
            if (currentGender === 'male') {
                genderNote.style.display = 'block';
            } else {
                genderNote.style.display = 'none';
            }
        }
        
        // 根据性别筛选症状
        function filterSymptomsByGender(gender) {
            const symptomItems = document.querySelectorAll('.question-item');
            
            symptomItems.forEach(item => {
                const isFemaleOnly = item.dataset.femaleOnly === 'true';
                
                if (gender === 'male' && isFemaleOnly) {
                    item.style.display = 'none';
                    // 同时取消选择该症状
                    const checkbox = item.querySelector('input[type="checkbox"]');
                    if (checkbox) checkbox.checked = false;
                } else {
                    item.style.display = 'block';
                }
            });
            
            updateSelectionCount();
        }
        
        // 更新选择计数
        function updateSelectionCount() {
            const checkedSymptoms = document.querySelectorAll('input[name="symptom"]:checked');
            document.getElementById('selection-count').textContent = `已选择 ${checkedSymptoms.length} 个症状`;
        }
        
        // 重置问卷
        function resetQuestionnaire() {
            // 重置症状选择
            document.querySelectorAll('input[name="symptom"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // 重置报告
            document.getElementById('dimension-results').innerHTML = '';
            document.getElementById('report-container').classList.add('hidden');
            
            updateSelectionCount();
        }
        
        // 验证个人信息表单
        function validatePersonalInfo() {
            const name = document.getElementById('name').value.trim();
            const gender = document.querySelector('input[name="gender"]:checked');
            const age = document.getElementById('age').value.trim();
            const recordDate = document.getElementById('record-date').value;
            
            if (!name) {
                alert('请填写姓名');
                return false;
            }
            
            if (!gender) {
                alert('请选择性别');
                return false;
            }
            
            if (!age) {
                alert('请填写年龄');
                return false;
            }
            
            if (isNaN(age) || age < 1 || age > 120) {
                alert('请填写有效的年龄（1-120岁）');
                return false;
            }
            
            if (!recordDate) {
                alert('请选择填表日期');
                return false;
            }
            
            return true;
        }
        
        // 计算分数并生成报告
        function calculateScores() {
            // 验证个人信息
            if (!validatePersonalInfo()) {
                return;
            }
            
            // 获取个人信息
            currentPersonalInfo = {
                name: document.getElementById('name').value.trim(),
                gender: document.querySelector('input[name="gender"]:checked').value,
                age: document.getElementById('age').value.trim(),
                recordDate: document.getElementById('record-date').value,
                occupation: document.getElementById('occupation').value.trim(),
                education: document.getElementById('education').value,
                phone: document.getElementById('phone').value.trim()
            };
            
            // 获取选中的症状
            let checkedSymptoms = document.querySelectorAll('input[name="symptom"]:checked');
            
            // 如果性别是男性，过滤掉女性专属症状（即使被选中）
            if (currentPersonalInfo.gender === 'male') {
                const checkedArray = Array.from(checkedSymptoms);
                checkedSymptoms = checkedArray.filter(symptom => {
                    const symptomId = parseInt(symptom.value);
                    const symptomData = symptoms.find(s => s.id === symptomId);
                    return !symptomData || !symptomData.femaleOnly;
                });
            }
            
            // 保存当前选中的症状ID
            currentSelectedSymptoms = Array.from(checkedSymptoms).map(symptom => parseInt(symptom.value));
            
            if (checkedSymptoms.length === 0) {
                alert('请至少选择一项症状后再进行计算');
                return;
            }
            
            // 初始化维度统计数据
            const dimensionStats = {};
            healthDimensions.forEach(dimension => {
                dimensionStats[dimension.id] = {
                    name: dimension.name,
                    color: dimension.color,
                    icon: dimension.icon,
                    description: dimension.description,
                    selectedCount: 0,
                    totalCount: 0
                };
            });
            
            // 计算每个维度的总症状数（根据性别调整）
            symptoms.forEach(symptom => {
                // 如果性别是男性且症状是女性专属，则跳过
                if (currentPersonalInfo.gender === 'male' && symptom.femaleOnly) {
                    return;
                }
                
                symptom.tags.forEach(tagId => {
                    if (dimensionStats[tagId]) {
                        dimensionStats[tagId].totalCount++;
                    }
                });
            });
            
            // 计算每个维度被选中的症状数
            checkedSymptoms.forEach(symptom => {
                const tags = JSON.parse(symptom.getAttribute('data-tags'));
                tags.forEach(tagId => {
                    if (dimensionStats[tagId]) {
                        dimensionStats[tagId].selectedCount++;
                    }
                });
            });
            
            // 计算每个维度的得分百分比
            healthDimensions.forEach(dimension => {
                const stats = dimensionStats[dimension.id];
                if (stats.totalCount > 0) {
                    stats.percentage = Math.round((stats.selectedCount / stats.totalCount) * 100);
                } else {
                    stats.percentage = 0;
                }
            });
            
            // 保存当前维度统计数据
            currentDimensionStats = dimensionStats;
            
            // 显示维度得分
            displayDimensionScores(dimensionStats);
            
            // 生成报告
            generateReport(dimensionStats, currentPersonalInfo, checkedSymptoms.length);
            
            // 显示报告容器
            document.getElementById('report-container').classList.remove('hidden');
            
            // 滚动到报告部分
            document.querySelector('.results-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // 显示维度得分
        function displayDimensionScores(dimensionStats) {
            const resultsContainer = document.getElementById('dimension-results');
            resultsContainer.innerHTML = '<h3 style="margin-bottom: 20px; color: #166088;">身体维度得分分析</h3>';
            
            // 按百分比排序（从高到低）
            const sortedDimensions = healthDimensions
                .map(dim => ({...dim, ...dimensionStats[dim.id]}))
                .sort((a, b) => b.percentage - a.percentage);
            
            sortedDimensions.forEach(dimension => {
                const stats = dimensionStats[dimension.id];
                
                const scoreElement = document.createElement('div');
                scoreElement.className = 'dimension-score';
                scoreElement.innerHTML = `
                    <div class="dimension-name">
                        <span><i class="${stats.icon}" style="color: ${stats.color}; margin-right: 5px;"></i>${stats.name}</span>
                        <span>${stats.selectedCount}/${stats.totalCount}</span>
                    </div>
                    <div class="score-bar-container">
                        <div class="score-bar" style="width: ${stats.percentage}%; background-color: ${stats.color};"></div>
                    </div>
                    <div class="score-text">得分: ${stats.percentage}%</div>
                `;
                
                resultsContainer.appendChild(scoreElement);
            });
        }
        
        // 生成身体状态报告（简化版，去掉异常程度评估）
        function generateReport(dimensionStats, personalInfo, selectedSymptomsCount) {
            const reportContent = document.getElementById('report-content');
            reportContent.innerHTML = '';
            
            // 按得分排序（从高到低）
            const sortedDimensions = healthDimensions
                .map(dim => ({...dim, ...dimensionStats[dim.id]}))
                .filter(dim => dim.totalCount > 0) // 只显示有数据的维度
                .sort((a, b) => b.percentage - a.percentage);
            
            // 个人信息摘要
            reportContent.innerHTML += `
                <div style="margin-bottom: 20px; padding: 15px; background-color: #e9f2f9; border-radius: 8px;">
                    <h4 style="color: #166088; margin-bottom: 10px;">个人信息</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">
                        <div><strong>姓名:</strong> ${personalInfo.name}</div>
                        <div><strong>性别:</strong> ${personalInfo.gender === 'male' ? '男' : '女'}</div>
                        <div><strong>年龄:</strong> ${personalInfo.age}岁</div>
                        <div><strong>填表日期:</strong> ${formatDate(personalInfo.recordDate)}</div>
                        ${personalInfo.occupation ? `<div><strong>职业:</strong> ${personalInfo.occupation}</div>` : ''}
                        ${personalInfo.education ? `<div><strong>学历:</strong> ${personalInfo.education}</div>` : ''}
                        ${personalInfo.phone ? `<div><strong>电话:</strong> ${personalInfo.phone}</div>` : ''}
                    </div>
                </div>
            `;
            
            // 总体评估（简化版，去掉异常程度标签）
            const dimensionsWithData = sortedDimensions.filter(d => d.totalCount > 0);
            const totalScore = dimensionsWithData.length > 0 
                ? dimensionsWithData.reduce((sum, stat) => sum + stat.percentage, 0) / dimensionsWithData.length 
                : 0;
            
            reportContent.innerHTML += `
                <div style="margin-bottom: 20px; padding: 15px; background-color: #e9f2f9; border-radius: 8px;">
                    <h4 style="color: #166088; margin-bottom: 10px;">总体评估</h4>
                    <p><strong>平均身体维度得分:</strong> ${Math.round(totalScore)}%</p>
                    <p><strong>选择的症状数量:</strong> ${selectedSymptomsCount}个</p>
                    <p><strong>评估时间范围:</strong> 近三个月</p>
                </div>
            `;
            
            // 各维度分析结果（简化版，只显示得分和匹配症状数）
            if (sortedDimensions.length > 0) {
                reportContent.innerHTML += `
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #166088; margin-bottom: 15px;">各维度分析结果</h4>
                `;
                
                sortedDimensions.forEach(dimension => {
                    const stats = dimensionStats[dimension.id];
                    
                    const dimensionReport = document.createElement('div');
                    dimensionReport.className = 'report-dimension';
                    dimensionReport.innerHTML = `
                        <div class="dimension-header">
                            <div>
                                <strong style="color: ${stats.color}">
                                    <i class="${stats.icon}" style="margin-right: 5px;"></i>${stats.name}
                                </strong>
                            </div>
                            <div class="dimension-score-circle" style="background-color: ${stats.color}">
                                ${stats.percentage}%
                            </div>
                        </div>
                        <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">
                            匹配症状: ${stats.selectedCount}/${stats.totalCount} 个
                        </div>
                    `;
                    
                    reportContent.appendChild(dimensionReport);
                });
                
                reportContent.innerHTML += `</div>`;
            }
            
            // 报告说明
            reportContent.innerHTML += `
                <div style="margin-top: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 8px; border-left: 4px solid #ccc;">
                    <h4 style="color: #666; margin-bottom: 10px;">报告说明</h4>
                    <p style="font-size: 0.9rem; color: #666; line-height: 1.5;">
                        本报告基于您近三个月的身体感受，通过分析95项身体症状与7个健康维度的关联关系生成。
                        得分百分比表示您选择的症状占该维度总症状的比例。本报告仅供参考，不能替代专业医疗建议。
                    </p>
                </div>
            `;
        }
        
        // 格式化日期
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.getFullYear() + '年' + (date.getMonth() + 1) + '月' + date.getDate() + '日';
        }
        
        // 保存当前记录
        function saveCurrentRecord() {
            if (!currentPersonalInfo || !currentDimensionStats || !currentSelectedSymptoms) {
                alert('请先计算身体状态得分后再保存记录');
                return;
            }
            
            // 验证个人信息
            if (!validatePersonalInfo()) {
                return;
            }
            
            // 获取历史记录
            let history = JSON.parse(localStorage.getItem('bodyCheckHistory')) || [];
            
            // 创建新记录
            const newRecord = {
                id: Date.now(),
                personalInfo: currentPersonalInfo,
                selectedSymptoms: currentSelectedSymptoms,
                dimensionStats: currentDimensionStats,
                timestamp: new Date().toISOString()
            };
            
            // 添加到历史记录
            history.unshift(newRecord);
            
            // 只保留最近20条记录
            if (history.length > 20) {
                history = history.slice(0, 20);
            }
            
            // 保存到本地存储
            localStorage.setItem('bodyCheckHistory', JSON.stringify(history));
            
            // 更新历史记录计数
            updateHistoryCount();
            
            // 显示成功消息
            alert('记录保存成功！');
            
            // 如果历史记录列表是打开的，刷新列表
            if (!document.getElementById('history-list').classList.contains('hidden')) {
                displayHistoryList();
            }
        }
        
        // 更新历史记录计数
        function updateHistoryCount() {
            const history = JSON.parse(localStorage.getItem('bodyCheckHistory')) || [];
            document.getElementById('history-count').textContent = `共有 ${history.length} 条历史记录`;
        }
        
        // 切换历史记录列表显示
        function toggleHistoryList() {
            const historyList = document.getElementById('history-list');
            const emptyHistory = document.getElementById('empty-history');
            
            if (historyList.classList.contains('hidden')) {
                displayHistoryList();
                historyList.classList.remove('hidden');
                emptyHistory.classList.add('hidden');
            } else {
                historyList.classList.add('hidden');
                emptyHistory.classList.remove('hidden');
            }
        }
        
        // 显示历史记录列表
        function displayHistoryList() {
            const historyList = document.getElementById('history-list');
            const history = JSON.parse(localStorage.getItem('bodyCheckHistory')) || [];
            
            if (history.length === 0) {
                document.getElementById('empty-history').classList.remove('hidden');
                historyList.classList.add('hidden');
                return;
            }
            
            // 清空历史列表
            historyList.innerHTML = '';
            
            // 添加历史记录项
            history.forEach(record => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.dataset.recordId = record.id;
                
                // 计算前三个得分最高的维度
                const sortedDimensions = Object.entries(record.dimensionStats)
                    .filter(([_, stats]) => stats.totalCount > 0)
                    .sort((a, b) => b[1].percentage - a[1].percentage)
                    .slice(0, 3);
                
                historyItem.innerHTML = `
                    <div class="history-header">
                        <div class="history-date">${formatDate(record.personalInfo.recordDate)}</div>
                        <div class="history-name">${record.personalInfo.name}</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #666;">
                        ${record.personalInfo.gender === 'male' ? '男' : '女'}，${record.personalInfo.age}岁，${record.selectedSymptoms.length}个症状
                    </div>
                    <div class="history-scores">
                        ${sortedDimensions.map(([id, stats]) => 
                            `<span class="history-score-tag" style="border-color: ${stats.color}55; background-color: ${stats.color}22; color: ${stats.color}">
                                ${stats.name}: ${stats.percentage}%
                            </span>`
                        ).join('')}
                    </div>
                `;
                
                // 添加点击事件
                historyItem.addEventListener('click', function() {
                    // 移除之前选中的样式
                    document.querySelectorAll('.history-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    
                    // 添加选中样式
                    this.classList.add('selected');
                    
                    // 加载该记录
                    loadHistoryRecord(record);
                });
                
                historyList.appendChild(historyItem);
            });
        }
        
        // 加载历史记录
        function loadHistoryRecord(record) {
            // 加载个人信息
            document.getElementById('name').value = record.personalInfo.name;
            
            // 设置性别
            document.querySelectorAll('input[name="gender"]').forEach(radio => {
                radio.checked = radio.value === record.personalInfo.gender;
            });
            
            // 触发性别变化事件
            handleGenderChange();
            
            document.getElementById('age').value = record.personalInfo.age;
            document.getElementById('record-date').value = record.personalInfo.recordDate;
            document.getElementById('occupation').value = record.personalInfo.occupation || '';
            document.getElementById('education').value = record.personalInfo.education || '';
            document.getElementById('phone').value = record.personalInfo.phone || '';
            
            // 清空所有症状选择
            document.querySelectorAll('input[name="symptom"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // 设置选中的症状
            record.selectedSymptoms.forEach(symptomId => {
                const checkbox = document.getElementById(`symptom-${symptomId}`);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });
            
            // 更新选择计数
            updateSelectionCount();
            
            // 设置当前数据
            currentPersonalInfo = record.personalInfo;
            currentDimensionStats = record.dimensionStats;
            currentSelectedSymptoms = record.selectedSymptoms;
            
            // 显示维度得分
            displayDimensionScores(record.dimensionStats);
            
            // 生成报告
            generateReport(record.dimensionStats, record.personalInfo, record.selectedSymptoms.length);
            
            // 显示报告容器
            document.getElementById('report-container').classList.remove('hidden');
            
            // 滚动到顶部
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // 显示成功消息
            alert('历史记录加载成功！');
        }
        
        // 清空历史记录
        function clearHistory() {
            if (confirm('确定要清空所有历史记录吗？此操作不可恢复。')) {
                localStorage.removeItem('bodyCheckHistory');
                updateHistoryCount();
                document.getElementById('history-list').innerHTML = '';
                document.getElementById('empty-history').classList.remove('hidden');
                document.getElementById('history-list').classList.add('hidden');
                alert('历史记录已清空！');
            }
        }
    </script>
</body>
</html>